<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Claim</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 100px 20px;
    }
    input, button {
      margin: 10px;
      padding: 12px;
      font-size: 16px;
    }
    #claim {
      display: none;
    }
    .error { color: #ff4c4c; }
    .success { color: #7fea8c; }
    #timer {
      margin-top: 20px;
      font-size: 18px;
      color: #f0e68c;
    }
  </style>
</head>
<body>

  <h1>Claim your spot</h1>

  <input id="address" placeholder="Enter your Ordinals address" />
  <br />
  <button id="check">Check Access</button>
  <button id="claim">Secure now</button>
  <p id="message"></p>
  <p id="timer"></p>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbz0xx7E_VJZXaqm_3uxlMAZ3RHitsK3jd-26JABE4e-g01qUzXYWLj9p1EHITgAF3ZGow/exec";

    const message = document.getElementById("message");
    const claimBtn = document.getElementById("claim");
    const checkBtn = document.getElementById("check");
    const addressInput = document.getElementById("address");
    const timerEl = document.getElementById("timer");

    const startTime = new Date("2025-06-17T09:05:00Z");
    const endTime = new Date("2025-06-20T18:00:00Z");

    function updateTimer() {
      const now = new Date();
      if (now < startTime) {
        const diff = startTime - now;
        timerEl.textContent = `‚è≥ Starts in ${formatTime(diff)}`;
        checkBtn.disabled = true;
        claimBtn.disabled = true;
      } else if (now >= startTime && now <= endTime) {
        const diff = endTime - now;
        timerEl.textContent = `‚úÖ Ends in ${formatTime(diff)}`;
        checkBtn.disabled = false;
        claimBtn.disabled = false;
      } else {
        timerEl.textContent = "‚õî Claiming has ended.";
        checkBtn.disabled = true;
        claimBtn.disabled = true;
      }
    }

    function formatTime(ms) {
      const total = Math.floor(ms / 1000);
      const h = String(Math.floor(total / 3600)).padStart(2, '0');
      const m = String(Math.floor((total % 3600) / 60)).padStart(2, '0');
      const s = String(total % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    setInterval(updateTimer, 1000);
    updateTimer();

    checkBtn.onclick = async () => {
      const inputAddress = addressInput.value.trim();
      message.className = "";
      if (!inputAddress) return;

      try {
        const response = await fetch(`${API_URL}?address=${encodeURIComponent(inputAddress)}`);
        const result = await response.text();

        if (result === "already_claimed") {
          message.textContent = "‚úÖ –í–∏ –≤–∂–µ –∑–∞–∫–ª–µ–π–º–∏–ª–∏!";
          message.className = "success";
          claimBtn.style.display = "none";
        } else if (result === "success") {
          message.textContent = "‚úÖ –í–∏ –≤ –≤–∞–π—Ç–ª–∏—Å—Ç—ñ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ!";
          message.className = "success";
          claimBtn.style.display = "inline-block";
        } else {
          message.textContent = "‚ùå –í–∞—à–æ—ó –∞–¥—Ä–µ—Å–∏ –Ω–µ–º–∞—î –≤ –±—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É.";
          message.className = "error";
          claimBtn.style.display = "none";
        }
      } catch (err) {
        message.textContent = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.";
        message.className = "error";
      }
    };

    claimBtn.onclick = () => {
      message.textContent = "üéâ –í–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–∫–ª–µ–π–º–∏–ª–∏!";
      message.className = "success";
      claimBtn.style.display = "none";
    };
  </script>
</body>
</html>
